#!/bin/bash

#
# bootstrap.sh version 0.1.0
# https://github.com/AttainIT-Technologies/vm-ubuntu-osint
#

################################
# SCRIPT DEVELOPMENT IN PROGRESS
################################

# INSTALL PACKAGES
sudo apt install curl -y
sudo apt install jq -y

# BASHRC UPDATES
echo '#####################' >> ~/.bashrc
echo '# OSINT UPDATES BELOW' >> ~/.bashrc
echo 'OSINT_BIN=~/bin; export OSINT_BIN' >> ~/.bashrc
echo 'PATH=$OSINT_BIN:$PATH' >> ~/.bashrc
echo '# OSINT UPDATES ABOVE' >> ~/.bashrc
echo '#####################' >> ~/.bashrc

# UPDATE UBUNTU GLOBAL SETTINGS
gsettings set org.gnome.system.location enabled false
gsettings set org.gnome.desktop.screensaver lock-enabled false
gsettings set org.gnome.ControlCenter last-panel 'diagnostics'
gsettings set org.gnome.desktop.privacy remember-recent-files false
gsettings set org.gnome.settings-daemon.plugins.power sleep-inactive-ac-timeout 3600
gsettings set org.gnome.settings-daemon.plugins.power sleep-inactive-ac-type 'nothing'
gsettings set org.gnome.desktop.session idle-delay 0
gsettings set org.gnome.desktop.media-handling autorun-x-content-start-app []
gsettings set org.gnome.shell.extensions.dash-to-dock preferred-monitor 0

# INSTALL SSH SERVER
sudo apt install openssh-server -y
echo '# OSINT VM SSH UPDATES' | sudo tee -a /etc/ssh/sshd_config
echo 'PermitEmptyPasswords no' | sudo tee -a /etc/ssh/sshd_config
echo 'PermitRootLogin no' | sudo tee -a /etc/ssh/sshd_config
echo 'Protocol 2' | sudo tee -a /etc/ssh/sshd_config
echo 'ClientAliveInterval 300' | sudo tee -a /etc/ssh/sshd_config
echo 'MaxAuthTries 3' | sudo tee -a /etc/ssh/sshd_config
echo 'LoginGraceTime 20' | sudo tee -a /etc/ssh/sshd_config
echo 'ChallengeResponseAuthentication no' | sudo tee -a /etc/ssh/sshd_config
echo 'KerberosAuthentication no' | sudo tee -a /etc/ssh/sshd_config
echo 'GSSAPIAuthentication no' | sudo tee -a /etc/ssh/sshd_config
echo 'X11Forwarding no' | sudo tee -a /etc/ssh/sshd_config
echo 'PermitUserEnvironment no' | sudo tee -a /etc/ssh/sshd_config
echo 'AllowAgentForwarding no' | sudo tee -a /etc/ssh/sshd_config
echo 'AllowTcpForwarding no' | sudo tee -a /etc/ssh/sshd_config
echo 'PermitTunnel no' | sudo tee -a /etc/ssh/sshd_config
echo 'PrintLastLog yes' | sudo tee -a /etc/ssh/sshd_config
sudo service sshd reload

# INSTALL FTP SERVER
sudo apt install vsftpd -y
sudo openssl req -x509 -nodes -days 3650 -newkey rsa:4096 -subj "/C=US/ST=Denial/L=Springfield/O=osint/CN=osint.local" -keyout /etc/ssl/private/vsftpd.pem -out /etc/ssl/private/vsftpd.pem
echo '# OSINT VM FTP UPDATES' | sudo tee -a /etc/vsftpd.conf
echo 'write_enable=YES' | sudo tee -a /etc/vsftpd.conf
sudo sed -i '/rsa_cert_file/s/^/#/' /etc/vsftpd.conf
sudo sed -i '/rsa_private_key_file/s/^/#/' /etc/vsftpd.conf
sudo sed -i '/ssl_enable/s/^/#/' /etc/vsftpd.conf
echo 'rsa_cert_file=/etc/ssl/private/vsftpd.pem' | sudo tee -a /etc/vsftpd.conf
echo 'rsa_private_key_file=/etc/ssl/private/vsftpd.pem' | sudo tee -a /etc/vsftpd.conf
echo 'ssl_enable=YES' | sudo tee -a /etc/vsftpd.conf
sudo systemctl restart vsftpd

# INSTALL MOZILLA FIREFOX ADDONS
firefox -CreateProfile default-release
FF_RELEASE=`find /home/$USER/.mozilla/firefox -maxdepth 1 -type d | grep default-release`
FF_EXT=$FF_RELEASE'/extensions'
mkdir -p $FF_EXT
cd extensions
wget https://addons.mozilla.org/firefox/downloads/file/3421533/startpagecom_private_search_engine-1.3.0-fx.xpi -O $FF_EXT/{20fc2e06-e3e4-4b2b-812b-ab431220cada}.xpi
wget https://addons.mozilla.org/firefox/downloads/file/993242/exif_viewer-3.7.5-an+fx.xpi -O $FF_EXT/exif_viewer@mozilla.doslash.org.xpi
wget https://addons.mozilla.org/firefox/downloads/file/3907697/firefox_multi_account_containers-8.0.6-fx.xpi -O $FF_EXT/@testpilot-containers.xpi
wget https://addons.mozilla.org/firefox/downloads/file/3809748/https_everywhere-2021.7.13-an+fx.xpi -O $FF_EXT/https-everywhere@eff.org.xpi
wget https://addons.mozilla.org/firefox/downloads/file/3872283/privacy_badger-2021.11.23.1-an+fx.xpi -O $FF_EXT/jid1-MnnxcxisBPnSXQ@jetpack.xpi
wget https://addons.mozilla.org/firefox/downloads/file/3769639/user_agent_switcher_and_manager-0.4.7.1-an+fx.xpi -O $FF_EXT{a6c4a591-f1b2-4f03-b3ff-767e5bedf4e7}.xpi
